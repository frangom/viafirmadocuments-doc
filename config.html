<!DOCTYPE html>

<html lang="es">
<head>
<meta charset="utf-8" />
<!--[if IE]><![endif]-->

<meta name="version" content="Mobile Services - v: Node 2 - 1.0.4.b71.r14623" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />

<title>Mobile Services - Configuración</title>


<script>
	var LOCALE = 'es';
</script>
<script type="text/javascript" src="js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="js/bootstrap.js"></script>
<script type="text/javascript" src="js/flaminwork.js"></script>
<script type="text/javascript" src="js/main.js"></script>

<script> 
		$(function(){
			$("#header").load("head.html");
			$("#footer").load("foot.html");
		});
	</script>

<link type="text/css" rel="stylesheet" href="css/bootstrap.css" />
<link type="text/css" rel="stylesheet" href="css/flaminwork.css" />
<link type="text/css" rel="stylesheet" href="css/styles.css" />
<body>
	<script>
            jQuery('body:not(.js)').addClass('js');
        </script>
	<div id="wrapper">

		<div id="header"></div>


		<hr class="hide" />

		<div class="wrapper">
			<div id="content-top" class="wrapper"></div>

			<div id="content">
				<ul class="tabs group">
					<li class="first odd"><a href="index.html">Quick Start</a></li>
					<li class="even"><a href="install.html">Instalación</a></li>
					<li class="current odd hover"><a href="config.html">Configuración</a></li>
<!-- 					<li class="even"><a href="errors.html">Errores</a></li> -->
<!--					<li class="even"><a href="conocimiento.html">Base de Conocimiento</a></li> -->
					<li class="odd"><a href="using.html">Utilización</a></li>
					<li class="last even"><a href="mobileApp.html">Mobile App</a></li>

				</ul>

				<div class="wrapper">

					<div class="container-fluid">
						<div class="row-fluid">
							<div class="col-lg-4">
								<div class="well sidebar-nav">
									<ul class="nav nav-list">
										<li class="nav-header first odd">1. Descripción de
											Properties</li>
										<li class="even"><a href="#push">Notificaciones Push</a></li>
										<li class="odd"><a href="#cache">Caché y Persistencia</a></li>
										<li class="even"><a href="#auditory">Auditoría</a></li>
										<li class="odd"><a href="#imprepositorio">Repositorios</a></li>
										<li class="even"><a href="#repoconfig">Config
												Repositorio</a></li>
										<li class="odd"><a href="#multirepo">Múltiple
												Repositorio</a></li>
										<li class="even"><a href="#repoproperties">Propiedades
												del Repositorio</a></li>
										<li class="odd"><a href="#platformconfig">Viafirma
												platform</a></li>
										<li class="even"><a href="#serviceinfo">Id del
												Servicio</a></li>
										<li class="nav-header odd">2. Ejemplos de Configuración</li>
										<li class="even"><a href="#configurationSamples">Context
												y Properties</a></li>
										<li class="last odd"><a href="#tomcatConfigSamples">Configuración
												Tomcat</a></li>
									</ul>
								</div>
							</div>
							<div class="col-lg-8">
								<div class="hero-unit">
									<h2>Mobile Services :: configuración del properties</h2>
									<h4>Versión: 1.0 - 02-dic-2013</h4>
								</div>

								<div class="row-fluid">
									<div class="span9">
										<section id="1">
											<h2>1. - Descripción de Properties</h2>

											<section id="push">
												<h3>Configuración de Notificaciones Push</h3>


												<h5>IS_PRODUCTION</h5>
												<ul>
													<li class="first odd">Valores posibles true o false</li>
													<li class="last even">Determina el uso o no del entorno de pruebas (sandbox) del proveedor de
														notificaciones push.</li>
												</ul>

												<h5>KEYSTORE_APPLE_NETWORK</h5>

												<ul>
													<li class="first odd">Indica la ruta donde se
														encuentra el certificado digital usado para la
														comunicación con el proveedor de notificaciones push.</li>
													<li class="even">El certificado debe pertenecer al
														firmante de la aplicación iOS, y puede ser ubicado en
														cualquier path con visibilidad.</li>
													<li class="last odd hover">Ej. <code>/provisioning/apple_apn_sandbox_ios.p12</code></li>
												</ul>

											</section>

											<section id="cache">
												<h3>Configuración de la Caché y Persistencia</h3>


												<h5>PERSISTENCE_STORAGE</h5>
												<ul>
													<li class="first odd">Ubicación física utilizada para
														la persistencia de la caché gestionada por el sistema.</li>
													<li class="even">Se recomienda no usar rutas del tipo
														/tmp para evitar su eliminación accidental tras un reset
														del servidor.</li>
													<li class="last odd">Ej. <code>/home/cache/</code></li>
												</ul>


											</section>

											<section id="auditory">
												<h3>Configuración de la Auditoría</h3>


												<h5>AUDITORY_PATH</h5>
												<ul>
													<li class="first odd">Path donde persistimos los logs
														de auditoría que serán procesados por el sistema.</li>
													<li class="last even">Ej. <code>/home/auditory</code></li>
												</ul>

											</section>

											<section id="imprepositorio">
												<h3>Definir la implementación del Repositorio</h3>

												<h5>REPOSITORIO_IMPL</h5>

												<p>Indica qué implementación se ha seleccionado para la
													persistencia de documentos. El sistema permite hasta tres
													tipo de persistencia: sobre fichero, sobre CMiS y sobre
													FTP. Los valores para cada caso son los siguientes:</p>

												<h6>Filesystem</h6>
												<ul>
													<li class="first odd">Persistencia sobre sistema de
														ficheros NFS</li>
													<li class="last even">Valor: <pre>com.viavansi.framework.tools.repositorio.ManagerFileRepositorySimpleImpl</pre></li>
												</ul>

												<h6>CMiS</h6>
												<ul>
													<li class="first odd">Persistencia sobre cualquier
														gestor documental (ECM) con soporte CMiS</li>
													<li class="last even">Valor: <pre>com.viavansi.framework.tools.repositorio.CmisManagerFileRepositoryImpl</pre></li>
												</ul>


												<h6>FTP</h6>
												<ul>
													<li class="first odd">Persistencia sobre FTP</li>
													<li class="last even">Valor: <pre>com.viavansi.framework.tools.repositorio.FtpFileRepositorySimpleImpl</pre></li>
												</ul>


											</section>

											<section id="repoconfig">
												<h3>Configurar el repositorio</h3>

												<section id="multirepo">
													<h4>Multi-repositorio</h4>
													<p>Tras haber definido el tipo de implementación
														deseada para el repositorio, hay que configurar los tres
														posibles path de destinos:</p>

													<dl>
														<dt class="first">template</dt>
														<dd class="first">
															Repositorio desde el que se recuperarán las plantillas
															usadas por el sistema para la construcción de PDFs. Los
															formatos de plantillas admitidos son <strong>.doc,
																.docx, .odt</strong>.
														</dd>
														<dt>drafted</dt>
														<dd>
															Repositorio temporal donde se ubican los documentos ya
															convertidos a <strong>PDF</strong> y están en espera de
															ser firmados.
														</dd>

														<dt class="last">signed</dt>
														<dd>Repositorio donde se almacenarán los documentos
															tras ser firmados.</dd>
														<dd class="last">
															Para cada operación de firma, se persistirán los
															siguientes documentos:
															<ul>
																<li class="first odd"><strong>PDF firmado</strong>
																	<ul>
																		<li class="first odd">El PDF incluye el contenido
																			del documento + anotaciones + fichero XML</li>
																		<li class="even">Las anotaciones son opcionales,
																			dependiendo de la política de firma utilizada. Una
																			anotación podrá consistir en la foto capturada desde
																			el dispositivo móvil e incrustada en el PDF. Otra
																			anotación podrá ser la firma digitalizada capturada
																			también en el dispositivo móvil.</li>
																		<li class="last odd">El XML incluido dentro del
																			XML contiene toda la información biométrica capturada
																			en el dispositivo móvil, así como las evidencias
																			electrónicas recopiladas, como posición GPS,
																			timestamp, sello de un tercero de confianza, etc.</li>
																	</ul></li>

																<li class="last even"><strong>XML</strong>
																	<ul>
																		<li class="first last odd">En caso de que se
																			deseen indexar los datos persistidos en el
																			repositorio, se genera un XML por cada documento
																			firmado con toda la información asociada a la
																			operación.</li>
																	</ul></li>
															</ul>
														</dd>
													</dl>
												</section>

												<section id="repoproperties">
													<h4>Propiedades para cada repositorio</h4>

													<p>La configuración para cada tipo de path en nuestro
														repositorio se define a partir de las siguientes variables
														de configuración:</p>


													<h5>PATH_BASE</h5>
													<p>Indica el path base que usaremos para cada tipo de
														documentos (template, drafted o signed).</p>
													<p>Para cada tipo de repositorio el nombre de la
														variable cambiará, por ejemplo:</p>

													<ul>
														<li class="first odd"><code>fileSystem.template.PATH_BASE</code></li>
														<li class="even"><code>cmis.template.PATH_BASE</code></li>
														<li class="last odd"><code>ftp.template.PATH_BASE</code></li>
													</ul>

													<p>
														Ej.
														<code>ftp.template.PATH_BASE =
															/home/repository/template/</code>
													</p>

													<p>Esta configuración deberá repetirse para cada tipo
														de destino (template, drafted o signed). Por ejemplo, para
														un tipo de implementación del tipo ftp, la configuración
														sería de la siguiente forma:</p>

													<ul>
														<li class="first odd">ftp.template.PATH_BASE =
															/home/repository/template/</li>
														<li class="even">ftp.drafted.PATH_BASE =
															/home/repository/drafted/</li>
														<li class="last odd">ftp.signed.PATH_BASE =
															/home/repository/signed/</li>
													</ul>


													<h5>VERSIONAR</h5>
													<p>Indica los documentos persistidos deben ser
														versionados. Esta configuración dependerá del tipo de
														implementación elegida.</p>
													<p>Para cada tipo de repositorio el nombre de la
														variable cambiará, por ejemplo:</p>
													<ul>
														<li class="first odd"><code>fileSystem.template.VERSIONAR</code></li>
														<li class="even"><code>cmis.template.VERSIONAR</code></li>
														<li class="last odd"><code>ftp.template.VERSIONAR</code></li>
													</ul>
													<p></p>
													<p>
														Ej.
														<code>cmis.template.VERSIONAR = true</code>
													</p>

													<p>Esta configuración deberá repetirse para cada tipo
														de destino (template, drafted o signed). Por ejemplo, para
														un tipo de implementación del tipo cmis, la configuración
														sería de la siguiente forma:</p>
													<ul>
														<li class="first odd">cmis.template.VERSIONAR = true</li>
														<li class="even">cmis.drafted..VERSIONAR = true</li>
														<li class="last odd">cmis.signed.VERSIONAR = true</li>
													</ul>
													<p></p>


												</section>
											</section>


											<section id="platformconfig">
												<h3>Configuración de viafirma platform (motor de firma)</h3>

												<p>Este servicio será el encargado de todo lo
													relacionado con la firma digital, validación de firmas,
													validación de certificados digitales, etc.</p>

												<h5>VIAFIRMA_URL</h5>
												<p>
													Url del servicio. Ej.
													<code>http://testservices.viafirma.com/viafirma</code>
												</p>

												<h5>CONFIG_VIAFIRMA_CLIENT</h5>

												<p>
													Configuración del cliente de viafirma platform, con el
													siguiente formato
													<code>URL_SERVICE;AUTH_SERVICE;API-KEY;API-PASSWORD</code>
													, donde:
												</p>
												<ul>
													<li class="first odd"><strong>URL_SERVICE</strong>:
														URL del servicio principal.</li>
													<li class="even"><strong>AUTH_SERVICE</strong>:
														Implementación utilizada para la autenticación del
														servicio (RMI, WebService o REST).</li>
													<li class="odd"><strong>API-KEY</strong>: Credenciales
														del cliente: código de aplicación.</li>
													<li class="last even"><strong>API-PASSWORD</strong>:
														Credenciales del cliente: password de aplicación.</li>
												</ul>

												<p>
													Ej.
													<code>http://viafirma.mycompany.com;http://viafirma.mycompany.com;API-KEY-XXX;API-PASS-xxx</code>
												</p>


											</section>

											<section id="serviceinfo">
												<h3>Identificación del Servicio</h3>

												<p>Esta configuración nos permitirá identificar al
													servicio a través de las siguientes variables de
													configuración:</p>

												<h5>APPLICATION_URL</h5>

												<p>URL en la que se publica el servicio.</p>
												<p>
													Ej.
													<code>http://dev.viafirma.com/mobile-services</code>
												</p>

												<h5>GOOGLE_GCM_KEY</h5>
												<p>En caso de usar google analitycs indicar en esta
													variable la KEY facilitada.</p>

												<h5>VERSION</h5>
												<p>La distribución de viafirma mobile services se
													etiquetará con la siguiente sintaxis:</p>
												<p>
													<code>VERSION=.b.r</code>
												</p>
												<p>En este parámetro se podrá incluir algún prefijo o
													sufijo que aporte cualquier otra información deseada.</p>

											</section>

										</section>
									</div>
								</div>


								<div class="row-fluid">
									<div class="span9">

										<h2>2. - Ejemplos de Configuración</h2>


										<section id="configurationSamples">
											<h3>Configuración Mobile Services</h3>
											<p>La configuración explicada en el capítulo anterior
												puede aplicarse de dos formas distintas, bien a través del
												fichero de un fichero de configuración config.properties o
												bien a a través del contexto de aplicación
												mobile-services.xml</p>
											<p>
												En el primer caso, el fichero de configuración
												config.properties debemos editarlo en la siguiente
												ubicación:
												<code>
													/
													<code>&lt;TOMCAT_HOME&gt;/conf/server.xml</code>
													/webapps/mobile-services/WEB-INF/classes/config.properties
												</code>
											</p>
											<p>
												En el segundo caso, el contexto debe editarse en la
												siguiente ubicación:
												<code>
													/
													<code>&lt;TOMCAT_HOME&gt;/conf/server.xml</code>
													/conf/Catalina/localhost/mobile-services.xml
												</code>
											</p>
											<p>A continuación se ofrecen dos ejemplos de
												configuración, un para cada tipo:</p>
											<ul>
												<li class="first odd">Properties de ejemplo:<a
													href="resources/config_sample.properties">
														config_sample.properties</a></li>
												<li class="last even">Contexto de ejemplo:<a
													href="resources/mobile-services.xml">
														mobile-services.xml</a></li>
											</ul>
										</section>

										<section id="tomcatConfigSamples">
											<h3>Configuración Apache Tomcat</h3>
											<p>A continuación se explicarán las configuraciones
												recomendadas para el servidor de aplicaciones Apache Tomcat
												y conseguir así un rendimiento óptimo.</p>
											<h4>Configuración en Clúster</h4>
											<p>Mobile Services permite su configuración en clúster
												para alta disponibilidad. En cada nodo que se desee disponer
												habrá que configurar el tomcat con las propiedades adecuadas
												en cada caso.</p>
											<ul>
												<li class="first last odd">Tomcat configurado para
													clúster:<a
													href="http://dev.viafirma.com/mobile-services/docs/resources/server.xml">
														server.xml</a> (<code>&lt;TOMCAT_HOME&gt;/conf/server.xml</code>)
												</li>
											</ul>
											<h4>Peso de Ficheros Admitidos</h4>
											<p>
												Por defecto Tomcat limita el envío mediante
												<code>POST</code>
												de 2Mb. Para ampliar este tamaño habrá que indicarlo de
												forma específica tal y como se muestra en el siguiente
												ejemplo que se permite hasta 10Mb.:
											</p>
											<p></p>
											<pre>&lt;Connector port="9080" protocol="HTTP/1.1" connectionTimeout="20000" 
  redirectPort="9443" maxPostSize="10485760"/ &gt;
</pre>
											<p></p>
											<p>
												Esta configuración habrá que indicarla en el server.xml del
												Tomcat (
												<code>&lt;TOMCAT_HOME&gt;/conf/server.xml</code>
												), y en caso de disponer de un clúster, habrá que repetir la
												configuración en cada nodo.
											</p>


										</section>

									</div>
								</div>






							</div>
						</div>

					</div>
				</div>

			</div>

			<div id="content-bottom" class="wrapper"></div>


			<hr class="hide" />

			<div id="footer"></div>

		</div>

	</div>
</body>
</html>
